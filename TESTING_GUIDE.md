# 测试指南

## 测试环境准备

### 1. 启动后端服务

```bash
# 进入后端项目目录
cd /Users/yingfu/project/monitor-system

# 启动 API Server
./bin/monitor-server -config ./configs/server-config.yaml

# 在被监控服务器上启动 Agent
./bin/monitor-agent -config ./configs/agent-config.yaml
```

### 2. 启动 React Native 应用

```bash
cd /Users/yingfu/project/monitor

# 启动 Metro bundler
npm start

# 在另一个终端运行应用
# iOS
npm run ios

# Android
npm run android
```

## 功能测试清单

### ✅ 1. 首页网络图标测试

**目标**: 验证服务器卡片显示上行/下行箭头图标

**步骤**:
1. 打开应用，查看首页服务器列表
2. 检查每个服务器卡片底部的指标区域
3. 确认第三个指标显示：
   - 上行箭头（红色）+ 数值
   - 下行箭头（绿色）+ 数值

**预期结果**: 网络指标使用箭头图标而不是网络图标

---

### ✅ 2. 网络详情页测试

**目标**: 验证网络详情页的功能和数据显示

**步骤**:
1. 点击任意服务器卡片进入详情页
2. 点击"网络"卡片（带有 ChevronRight 箭头）
3. 查看网络详情页内容

**预期结果**:
- 显示所有网络接口（eth0, eth1, lo 等）
- 每个接口显示实时上行/下行速度
- 显示总上传/下载流量
- 数据每 3 秒自动刷新
- 下拉可手动刷新
- 点击左上角返回按钮返回服务器详情页

---

### ✅ 3. 磁盘详情页测试

**目标**: 验证磁盘详情页的功能和数据显示

**步骤**:
1. 在服务器详情页点击"磁盘"卡片
2. 查看磁盘详情页内容

**预期结果**:
- 显示所有磁盘分区
- 每个分区显示：
  - 设备名称和挂载点
  - 总大小、已使用、剩余空间
  - 文件系统类型
  - 使用率进度条
- 下拉可手动刷新
- 点击左上角返回按钮返回服务器详情页

---

### ✅ 4. 进程管理页测试

**目标**: 验证进程管理页的功能和数据显示

**步骤**:
1. 在服务器详情页点击"进程管理"卡片
2. 查看进程列表页内容

**预期结果**:
- 显示按 CPU 使用率排序的进程列表
- 每个进程显示：
  - 进程名称和 PID
  - CPU 使用率（蓝色）
  - 内存使用率（绿色）
- 数据每 5 秒自动刷新
- 下拉可手动刷新
- 点击左上角返回按钮返回服务器详情页

---

### ✅ 5. 设置功能测试

**目标**: 验证设置对话框的编辑和保存功能

**步骤**:
1. 点击首页右上角的设置图标
2. 在设置对话框中：
   - 修改 API 地址（例如：http://10.0.2.2）
   - 修改端口（例如：8080）
   - 输入 API 秘钥（可选）
3. 点击"保存"按钮
4. 观察首页服务器列表是否重新加载

**预期结果**:
- 设置对话框显示当前配置
- 所有字段可编辑
- 必填项验证（API 地址和端口）
- 端口格式验证（必须是数字）
- 保存后对话框关闭
- API 配置立即生效

**测试用例**:
- ✅ 空 API 地址 → 显示错误提示
- ✅ 空端口 → 显示错误提示
- ✅ 非数字端口（如 "abc"） → 显示错误提示
- ✅ 正确输入 → 保存成功

---

### ✅ 6. Android 返回键测试

**目标**: 验证 Android 返回键的正确行为

**仅限 Android 设备测试**

**测试场景 1**: 从子详情页返回
1. 进入服务器详情页
2. 点击网络/磁盘/进程管理进入子详情页
3. 按手机返回键

**预期**: 返回到服务器详情页（不退出应用）

**测试场景 2**: 从服务器详情页返回
1. 在首页点击服务器卡片进入详情页
2. 按手机返回键

**预期**: 返回到首页（不退出应用）

**测试场景 3**: 从首页退出
1. 在首页按手机返回键

**预期**: 退出应用

---

### ✅ 7. 后端 API 集成测试

**目标**: 验证应用正确从后端获取数据

**前提条件**: 后端 API Server 和 Agent 正在运行

**步骤**:
1. 配置正确的 API 地址和端口
2. 观察首页服务器列表
3. 点击服务器进入详情页
4. 观察指标数据
5. 查看历史数据图表

**预期结果**:
- 首页显示后端返回的服务器列表
- 服务器详情页显示真实指标数据
- 图表显示真实历史数据
- 数据定期自动刷新
- 如果后端未运行，显示演示数据

**验证方法**:
- 检查控制台日志，无 API 错误
- 对比后端返回的数据和应用显示的数据
- 停止 Agent，观察服务器状态变为"离线"

---

## 性能测试

### 内存使用
- 打开应用后长时间运行（10 分钟）
- 在多个页面间切换
- 观察内存使用是否稳定

### 刷新性能
- 在各详情页测试下拉刷新
- 验证刷新速度和流畅度
- 确认自动刷新不会造成卡顿

---

## 错误场景测试

### 网络错误
1. 配置错误的 API 地址
2. 观察应用行为

**预期**: 显示演示数据，控制台有错误日志

### 后端停止
1. 配置正确后，停止后端服务
2. 观察应用行为

**预期**: 继续显示最后获取的数据或演示数据

---

## 测试记录

| 功能 | 测试日期 | 测试结果 | 备注 |
|------|---------|---------|------|
| 首页网络图标 | | | |
| 网络详情页 | | | |
| 磁盘详情页 | | | |
| 进程管理页 | | | |
| 设置功能 | | | |
| Android 返回键 | | | |
| 后端 API 集成 | | | |

---

## 问题报告模板

如发现问题，请按以下格式记录：

**问题描述**:
[简要描述问题]

**复现步骤**:
1.
2.
3.

**预期结果**:
[应该发生什么]

**实际结果**:
[实际发生了什么]

**环境信息**:
- 设备: [iOS/Android]
- 系统版本:
- 应用版本:
- 后端状态: [运行中/未运行]

**截图/日志**:
[如有可用]

---

**测试完成日期**: _____________
**测试人员**: _____________
